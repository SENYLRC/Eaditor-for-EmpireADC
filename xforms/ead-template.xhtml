<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2010 Ethan Gruber
    EADitor: https://github.com/ewg118/eaditor
    Apache License 2.0: https://github.com/ewg118/eaditor    
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:xi="http://www.w3.org/2001/XInclude"
	xmlns:ead="urn:isbn:1-931666-22-9" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:eaditor="https://github.com/ewg118/eaditor"
	xmlns:xxi="http://orbeon.org/oxf/xml/xinclude" xmlns:fr="http://orbeon.org/oxf/xml/form-runner">
	<head>
		<title>EADitor: Edit Core Template</title>
		<link rel="stylesheet" href="/fr/style/bootstrap/css/bootstrap.css" type="text/css"/>
		<link rel="stylesheet" href="/fr/style/form-runner-bootstrap-override.css" type="text/css"/>
		<link rel="stylesheet" href="/config/theme/examples.css" type="text/css" media="all"/>
		<link rel="shortcut icon" href="/ops/images/orbeon-icon-16.ico"/>
		<link rel="icon" href="/ops/images/orbeon-icon-16.png" type="image/png"/>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.8.0/build/cssgrids/grids-min.css"/>

		<!-- EADitor styling -->
		<link rel="stylesheet" href="/apps/eaditor/xforms/css/xforms.css"/>

		<xforms:model xmlns="urn:isbn:1-931666-22-9">
			<xs:schema elementFormDefault="qualified" attributeFormDefault="unqualified">
				<xs:simpleType name="iso8601date">
					<xs:restriction base="xs:string">
						<xs:pattern
							value="(\-?(0|1|2)([0-9]{3})(((01|02|03|04|05|06|07|08|09|10|11|12)((0[1-9])|((1|2)[0-9])|(3[0-1])))|\-((01|02|03|04|05|06|07|08|09|10|11|12)(\-((0[1-9])|((1|2)[0-9])|(3[0-1])))?))?)(/\-?(0|1|2)([0-9]{3})(((01|02|03|04|05|06|07|08|09|10|11|12)((0[1-9])|((1|2)[0-9])|(3[0-1])))|\-((01|02|03|04|05|06|07|08|09|10|11|12)(\-((0[1-9])|((1|2)[0-9])|(3[0-1])))?))?)?"
						/>
					</xs:restriction>
				</xs:simpleType>
			</xs:schema>

			<!-- exist URL is stored in an XML file -->
			<xforms:instance id="exist-config">
				<xi:include href="../exist-config.xml"/>
			</xforms:instance>
			
			<xforms:instance id="config">
				<config xmlns=""/>
			</xforms:instance>
			
			<xforms:instance id="control-instance">
				<controls xmlns="">
					<collection-name/>					
				</controls>
			</xforms:instance>
			
			<!-- authentication -->
			<xforms:instance id="collections-list" xxforms:exclude-result-prefixes="#all">
				<collections xmlns=""/>
			</xforms:instance>
			
			<xforms:instance id="dump">
				<dump xmlns=""/>
			</xforms:instance>

			<xforms:instance id="ead-template" xmlns:xlink="http://www.w3.org/1999/xlink">
				<ead xmlns="urn:isbn:1-931666-22-9"/>
			</xforms:instance>

			<!-- get from exist -->
			<xforms:instance id="c-template" xmlns:xlink="http://www.w3.org/1999/xlink">
				<c xmlns="urn:isbn:1-931666-22-9"/>
			</xforms:instance>
			

			<xforms:instance id="status">
				<status/>
			</xforms:instance>

			<!-- EAD ELEMENTS -->
			<!-- eadheader -->
			<xforms:instance id="profiledesc-template" xxforms:exclude-result-prefixes="#all">
				<profiledesc/>
			</xforms:instance>
			<xforms:instance id="revisiondesc-template" xxforms:exclude-result-prefixes="#all">
				<revisiondesc>
					<change>
						<date normal=""/>
						<item/>
					</change>
				</revisiondesc>
			</xforms:instance>
			<xforms:instance id="editionstmt-template" xxforms:exclude-result-prefixes="#all">
				<editionstmt>
					<edition/>
				</editionstmt>
			</xforms:instance>
			<xforms:instance id="notestmt-template" xxforms:exclude-result-prefixes="#all">
				<notestmt>
					<note>
						<p/>
					</note>
				</notestmt>
			</xforms:instance>
			<xforms:instance id="publicationstmt-template" xxforms:exclude-result-prefixes="#all">
				<publicationstmt/>
			</xforms:instance>
			<xforms:instance id="seriesstmt-template" xxforms:exclude-result-prefixes="#all">
				<seriesstmt/>
			</xforms:instance>

			<!-- shared/generic -->
			<xforms:instance id="author-template" xxforms:exclude-result-prefixes="#all">
				<author/>
			</xforms:instance>
			<xforms:instance id="creation-template" xxforms:exclude-result-prefixes="#all">
				<creation/>
			</xforms:instance>
			<xforms:instance id="change-template" xxforms:exclude-result-prefixes="#all">
				<change>
					<date normal=""/>
					<item/>
				</change>
			</xforms:instance>
			<xforms:instance id="date-template" xxforms:exclude-result-prefixes="#all">
				<date normal=""/>
			</xforms:instance>
			<xforms:instance id="descrules-template" xxforms:exclude-result-prefixes="#all">
				<descrules/>
			</xforms:instance>
			<xforms:instance id="langusage-template" xxforms:exclude-result-prefixes="#all">
				<langusage/>
			</xforms:instance>
			<xforms:instance id="num-template" xxforms:exclude-result-prefixes="#all">
				<num type=""/>
			</xforms:instance>
			<xforms:instance id="publisher-template" xxforms:exclude-result-prefixes="#all">
				<publisher/>
			</xforms:instance>
			<xforms:instance id="sponsor-template" xxforms:exclude-result-prefixes="#all">
				<sponsor/>
			</xforms:instance>
			<xforms:instance id="subtitle-template" xxforms:exclude-result-prefixes="#all">
				<subtitle/>
			</xforms:instance>
			<xforms:instance id="titleproper-template" xxforms:exclude-result-prefixes="#all">
				<titleproper/>
			</xforms:instance>
			<xforms:instance id="address-template" xxforms:exclude-result-prefixes="#all">
				<address>
					<addressline/>
				</address>
			</xforms:instance>
			<xforms:instance id="blockquote-template" xxforms:exclude-result-prefixes="#all">
				<blockquote/>
			</xforms:instance>
			<xforms:instance id="head-template" xxforms:exclude-result-prefixes="#all">
				<head/>
			</xforms:instance>
			<xforms:instance id="note-template" xxforms:exclude-result-prefixes="#all">
				<note>
					<p/>
				</note>
			</xforms:instance>
			<xforms:instance id="p-template" xxforms:exclude-result-prefixes="#all">
				<p/>
			</xforms:instance>

			<!-- archdesc instances -->
			<xforms:instance id="dsc-template" xxforms:exclude-result-prefixes="#all">
				<dsc/>
			</xforms:instance>

			<xforms:instance id="level-template">
				<levels xmlns="">
					<level value="">Select...</level>
					<level value="class">Class</level>
					<level value="collection">Collection</level>
					<level value="file">File</level>
					<level value="fonds">Fonds</level>
					<level value="item">Item</level>
					<level value="recordgrp">Record Group</level>
					<level value="series">Series</level>
					<level value="subfonds">Subfonds</level>
					<level value="subgrp">Subgroup</level>
					<level value="subseries">Subseries</level>
					<level value="otherlevel">Other Level</level>
				</levels>
			</xforms:instance>

			<xforms:bind node="instance('ead-template')">
				<xforms:bind nodeset="ead:eadheader"> </xforms:bind>
				<xforms:bind nodeset="ead:archdesc">
					<xforms:bind nodeset="ead:did">
						<xforms:bind nodeset="ead:langmaterial">
							<xforms:bind ref="ead:language">
								<xforms:bind constraint="string-length(@langcode) &gt; 0"/>
							</xforms:bind>
						</xforms:bind>
					</xforms:bind>
					<xforms:bind nodeset="ead:dsc">
						<xforms:bind nodeset="ead:c">
							<xforms:bind nodeset="@id" required="true()"/>
							<xforms:bind nodeset="ead:did/ead:unittitle" required="true()"/>
						</xforms:bind>
					</xforms:bind>
				</xforms:bind>
				<xforms:bind nodeset="//ead:tgroup/@cols" required="true()" type="xs:integer"/>
				<xforms:bind nodeset="//ead:listhead">
					<xforms:bind nodeset="ead:head01" required="true()"/>
					<xforms:bind nodeset="ead:head02" required="true()"/>
				</xforms:bind>
				<xforms:bind nodeset="//ead:ref" required="true()"/>
				<xforms:bind nodeset="//ead:extref" required="true()">
					<xforms:bind nodeset="@href" required="true()"/>
				</xforms:bind>
				<xforms:bind nodeset="//ead:dao/@href" required="true()"/>
				<xforms:bind nodeset="//ead:daoloc/@href" required="true()"/>
				<xforms:bind nodeset="//ead:defitem">
					<xforms:bind nodeset="ead:label" required="true()"/>
					<xforms:bind nodeset="ead:item" required="true()"/>
				</xforms:bind>
				<xforms:bind nodeset="//ead:unitdate/@normal" type="xs:date"/>
				<xforms:bind nodeset="//ead:date/@normal" type="xs:date"/>
			</xforms:bind>

			<!-- bind tabs -->
			<xforms:bind id="archdesc-tab" nodeset="instance('ead-template')/ead:archdesc"/>
			
			<xforms:submission id="load-collections" serialization="none" method="get" action="{instance('exist-config')/url}eaditor/collections-list.xml" replace="instance" instance="collections-list"
				xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<!-- if the config loads successfully, set the collection names based on authentication -->
				<xforms:action ev:event="xforms-submit-done">
					<!-- set default if security is false -->
					<xforms:action if="not(string(instance('control-instance')/request-security/role))">
						<xforms:setvalue ref="instance('control-instance')/collection-name"
							value="instance('collections-list')/collection[@role='']/@name"/>
					</xforms:action>
					<!-- if there is a security role, set the collection-name value if it is in the list, otherwise set new collection name -->
					<xforms:action if="string(instance('control-instance')/request-security/role)">
						<xforms:setvalue ref="instance('control-instance')/collection-name"
							value="instance('collections-list')/collection[@role=instance('control-instance')/request-security/role]/@name"/>
					</xforms:action>
					<xforms:send submission="load-config"/>
					<xforms:send submission="load-core-template"/>
					<xforms:send submission="load-c-template"/>
				</xforms:action>
				<!-- if the config has not been created (given that the URL in exist-url.xml is correct), create it -->
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to load EADitor collections list.</xforms:message>
			</xforms:submission>
			
			<xforms:submission id="load-config" serialization="none" method="get" action="{instance('exist-config')/url}eaditor/{instance('control-instance')/collection-name}/config.xml"
				replace="instance" instance="config" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message level="modal" ev:event="xforms-submit-error">Error loading config.</xforms:message>
			</xforms:submission>

			<!-- load preliminary instances -->
			<xforms:submission id="load-c-template" serialization="none" method="get" action="{instance('exist-config')/url}eaditor/{instance('control-instance')/collection-name}/c-template.xml" replace="instance"
				instance="c-template" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error loading component template.</xforms:message>
			</xforms:submission>

			<!-- Submission to get the document -->
			<xforms:submission id="load-core-template" serialization="none" method="get" action="{instance('exist-config')/url}eaditor/{instance('control-instance')/collection-name}/ead-template.xml"
				replace="instance" instance="ead-template" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error loading core template.</xforms:message>
			</xforms:submission>

			<!-- Submission to save the document -->
			<xforms:submission id="save-core-template" ref="instance('ead-template')" action="{instance('exist-config')/url}eaditor/{instance('control-instance')/collection-name}/ead-template.xml" method="put"
				replace="none" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error Saving Documents. Be sure all required inputs are filled in.</xforms:message>
				<xforms:setvalue ev:event="xforms-submit-done" ref="instance('status')">Template saved.</xforms:setvalue>
			</xforms:submission>

			<!-- ************************ xforms-model-construct-done ****************************** -->
			<xforms:action ev:event="xforms-model-construct-done">
				<xforms:insert context="instance('control-instance')" nodeset="collection-name" position="after"
					origin="xxforms:call-xpl('oxf:/apps/eaditor/xpl/get-authentication.xpl', 'dump', instance('dump'), 'data')"/>
				<xforms:send submission="load-collections"/>
			</xforms:action>
		</xforms:model>

		<!-- xbl components -->
		<xi:include href="xbl/access-elements/access-elements.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/accessrestrict/accessrestrict.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/accruals/accruals.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/acqinfo/acqinfo.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/address/address.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/altformavail/altformavail.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/appraisal/appraisal.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/arrangement/arrangement.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/attributes/attributes.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/bibliography/bibliography.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/bibref/bibref.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/bioghist/bioghist.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/blockquote/blockquote.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/c/c.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/chronlist/chronlist.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/component-level/component-level.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/controlaccess/controlaccess.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/corpname/corpname.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/creation/creation.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/custodhist/custodhist.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/dao/dao.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/daodesc/daodesc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/daogrp/daogrp.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/daoloc/daoloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/date/date.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/did/did.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/extptrloc/extptrloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/extref/extref.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/extrefloc/extrefloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/famname/famname.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/fileplan/fileplan.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/function/function.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/generic-elements/generic-elements.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/genreform/genreform.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/geogname/geogname.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/head/head.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/index/index.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/linkgrp/linkgrp.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/list/list.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/listhead/listhead.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/name/name.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/namegrp/namegrp.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/note/note.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/num/num.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/occupation/occupation.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/odd/odd.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/originalsloc/originalsloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/otherfindaid/otherfindaid.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/p/p.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/persname/persname.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/phystech/phystech.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/prefercite/prefercite.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/processinfo/processinfo.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/ptr/ptr.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/ptrgrp/ptrgrp.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/ptrloc/ptrloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/ref/ref.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/refloc/refloc.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/relatedmaterial/relatedmaterial.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/scopecontent/scopecontent.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/separatedmaterial/separatedmaterial.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/subject/subject.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/table/table.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/title/title.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/titleproper/titleproper.xbl" xxi:omit-xml-base="true"/>
		<xi:include href="xbl/userestrict/userestrict.xbl" xxi:omit-xml-base="true"/>
	</head>
	<body>
		<div class="yui3-g">
			<div class="yui3-u-1">
				<div class="content">
					<!-- header -->
					<xforms:var name="display_path">../../</xforms:var>
					<xi:include href="header.xml"/>
					<div id="form">
						<xforms:group ref="instance('status')/text()">
							<div class="success">
								<xforms:output ref="instance('status')"/>
							</div>
						</xforms:group>
						<p>
							<a href="{$display_path}templates/">&lt; Return</a>
						</p>
						<div class="submission">
							<xforms:submit submission="save-core-template" appearance="minimal">
								<xforms:label><span class="glyphicon glyphicon-floppy-disk"></span>Save</xforms:label>
							</xforms:submit>							
						</div>
						<div class="section">
							<h1>Edit EAD Finding Aid Core Template</h1>
						</div>
						<fr:tabview>
							<!--**************************************** EADHEADER **********************************-->
							<fr:tab id="eadheader-tab">
								<fr:label>EAD Header</fr:label>
								<xforms:group ref="instance('ead-template')/ead:eadheader">
									<h1>EAD Header</h1>
									<span class="add">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"/>
											</xforms:label>
											<xxforms:show ev:event="DOMActivate" dialog="eadheader-objects"/>
										</xforms:trigger>
									</span>
									<xxforms:dialog id="eadheader-objects" appearance="full" level="modal" close="true" draggable="true" visible="false">
										<xforms:label>EAD Header Elements</xforms:label>
										<xforms:group ref=".[count(ead:profiledesc) &lt; 1]">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-plus"/>Profile Description</xforms:label>
												<xforms:insert ev:event="DOMActivate" context="." nodeset="ead:filedesc"
													origin="instance('profiledesc-template')"/>
											</xforms:trigger>
										</xforms:group>
										<xforms:group ref=".[count(ead:revisiondesc) &lt; 1]">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-plus"/>Revision Description</xforms:label>
												<xforms:insert ev:event="DOMActivate" context="."
													nodeset="if (ead:profiledesc) then ead:profiledesc else ead:filedesc"
													origin="instance('revisiondesc-template')"/>
											</xforms:trigger>
										</xforms:group>
									</xxforms:dialog>
									<div class="section">
										<div>
											<xforms:input ref="ead:eadid">
												<xforms:label>EAD ID</xforms:label>
												<xforms:alert>EAD ID required</xforms:alert>
											</xforms:input>
										</div>
										<xforms:group ref=".[count(ead:eadid/@mainagencycode) &lt; 1]">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-plus"/>@mainagencycode</xforms:label>
												<xforms:insert ev:event="DOMActivate" context="ead:eadid" origin="xforms:attribute('mainagencycode', '')"/>
											</xforms:trigger>
										</xforms:group>
										<xforms:group ref=".[count(ead:eadid/@mainagencycode) &gt; 0]">
											<xforms:select1 ref="ead:eadid/@mainagencycode">
												<xforms:label>Agency Code</xforms:label>
												<xforms:item>
													<xforms:label>Select Agency...</xforms:label>
													<xforms:value/>
												</xforms:item>
												<xforms:itemset nodeset="instance('config')/templates/agencycodes/agencycode">
													<xforms:label ref="."/>
													<xforms:value ref="@value"/>
												</xforms:itemset>
												<xforms:alert>Agency Code required</xforms:alert>
											</xforms:select1>
											<xforms:trigger appearance="minimal">
												<xforms:delete ev:event="DOMActivate" context="ead:eadid/@mainagencycode"/>
												<xforms:label>
													<span class="glyphicon glyphicon-remove"/>
												</xforms:label>
											</xforms:trigger>
										</xforms:group>
									</div>
									<div class="section">
										<h2>File Description</h2>
										<span class="add">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-plus"/>
												</xforms:label>
												<xxforms:show ev:event="DOMActivate" dialog="filedesc-objects"/>
											</xforms:trigger>
										</span>
										<xxforms:dialog id="filedesc-objects" appearance="full" level="modal" close="true" draggable="true" visible="false">
											<xforms:label>File Description Elements</xforms:label>
											<xforms:group ref=".[count(//ead:editionstmt) &lt; 1]">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Edition Statement</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="ead:filedesc" nodeset="ead:titlestmt" position="after"
														origin="instance('editionstmt-template')"/>
												</xforms:trigger>
											</xforms:group>
											<xforms:group ref=".[count(//ead:publicationstmt) &lt; 1]">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Publication Statement</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="ead:filedesc"
														nodeset="if (ead:editionstmt) then ead:editionstmt else ead:titlestmt"
														origin="instance('publicationstmt-template')"/>
												</xforms:trigger>
											</xforms:group>
											<xforms:group ref=".[count(//ead:seriesstmt) &lt; 1]">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Series Statement</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="ead:filedesc"
														nodeset="if (ead:publicationstmt) then ead:publicationstmt else if (ead:editionstmt) then ead:editionstmt else ead:titlestmt"
														origin="instance('seriesstmt-template')"/>
												</xforms:trigger>
											</xforms:group>
											<xforms:group ref=".[count(//ead:notestmt) &lt; 1]">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Note Statement</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="ead:filedesc" nodeset="./child::node()[last()]"
														origin="instance('notestmt-template')"/>
												</xforms:trigger>
											</xforms:group>
										</xxforms:dialog>
										<xforms:group ref="ead:filedesc">
											<xforms:group ref="ead:titlestmt">
												<div class="subsection">
													<h3>Title Statement</h3>
													<span class="add">
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>
															</xforms:label>
															<xxforms:show ev:event="DOMActivate" dialog="titlestmt-objects"/>
														</xforms:trigger>
													</span>
													<xxforms:dialog id="titlestmt-objects" appearance="full" level="modal" close="true" draggable="true"
														visible="false">
														<xforms:label>Title Statement Elements</xforms:label>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Subtitle</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="."
																nodeset="if (ead:subtitle) then ead:subtitle[last()] else ead:titleproper"
																origin="instance('subtitle-template')"/>
														</xforms:trigger>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Author</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="."
																nodeset="if (ead:subtitle) then ead:subtitle else ead:titleproper"
																origin="instance('author-template')"/>
														</xforms:trigger>
														<xforms:group ref=".[count(ead:sponsor) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Sponsor</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="."
																	nodeset="if (ead:author) then ead:author else if (ead:subtitle) then ead:subtitle else ead:titleproper"
																	origin="instance('sponsor-template')"/>
															</xforms:trigger>
														</xforms:group>
													</xxforms:dialog>
													<div>
														<xforms:input ref="ead:titleproper">
															<xforms:label>Proper Title</xforms:label>
															<xforms:alert>Required</xforms:alert>
														</xforms:input>
													</div>
													<!-- subtitle -->
													<xforms:group ref="ead:subtitle">
														<div>
															<xforms:input ref=".">
																<xforms:label>Subtitle</xforms:label>
															</xforms:input>
															<xforms:trigger appearance="minimal">
																<xforms:delete ev:event="DOMActivate" nodeset="."/>
																<xforms:label>
																	<span class="glyphicon glyphicon-remove"/>
																</xforms:label>
															</xforms:trigger>
														</div>
													</xforms:group>
													<!-- author -->
													<xforms:repeat nodeset="ead:author">
														<div>
															<xforms:input ref=".">
																<xforms:label>Author</xforms:label>
															</xforms:input>
															<xforms:trigger appearance="minimal">
																<xforms:delete ev:event="DOMActivate" nodeset="."/>
																<xforms:label>
																	<span class="glyphicon glyphicon-remove"/>
																</xforms:label>
															</xforms:trigger>
														</div>
													</xforms:repeat>
													<!-- sponsor -->
													<xforms:group ref="ead:sponsor">
														<div>
															<xforms:input ref=".">
																<xforms:label>Sponsor</xforms:label>
															</xforms:input>
															<xforms:trigger appearance="minimal">
																<xforms:delete ev:event="DOMActivate" nodeset="."/>
																<xforms:label>
																	<span class="glyphicon glyphicon-remove"/>
																</xforms:label>
															</xforms:trigger>
														</div>
													</xforms:group>
												</div>
											</xforms:group>
											<!-- edition stmt -->
											<xforms:group ref="ead:editionstmt">
												<div class="subsection">
													<h3>Edition Statement</h3>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate"/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
													<div>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Paragraph</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="." origin="instance('p-template')"/>
														</xforms:trigger>
													</div>
													<xforms:group nodeset="ead:edition">
														<div>
															<xforms:input ref=".">
																<xforms:label>Edition</xforms:label>
																<xforms:alert>Required.</xforms:alert>
															</xforms:input>
														</div>
													</xforms:group>
													<!-- paragraph -->
													<xforms:repeat nodeset="ead:p">
														<eaditor:p/>
													</xforms:repeat>
												</div>
											</xforms:group>
											<!-- publication statement -->
											<xforms:group ref="ead:publicationstmt">
												<div class="subsection">
													<h3>Publication Statement</h3>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
													<span class="add">
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>
															</xforms:label>
															<xxforms:show ev:event="DOMActivate" dialog="publicationstmt-objects"/>
														</xforms:trigger>
													</span>
													<xxforms:dialog id="publicationstmt-objects" appearance="full" level="modal" close="true" draggable="true"
														visible="false">
														<xforms:label>Publication Statement Elements</xforms:label>
														<xforms:group ref=".[count(ead:address) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Address</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('address-template')"/>
															</xforms:trigger>
														</xforms:group>
														<xforms:group ref=".[count(ead:date) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Date</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('date-template')"/>
															</xforms:trigger>
														</xforms:group>
														<xforms:group ref=".[count(ead:num) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Number</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('num-template')"/>
															</xforms:trigger>
														</xforms:group>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Paragraph</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="." origin="instance('p-template')"/>
														</xforms:trigger>
														<xforms:group ref=".[count(ead:publisher) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Publisher</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('publisher-template')"/>
															</xforms:trigger>
														</xforms:group>
													</xxforms:dialog>
													<xforms:group ref=".[count(child::node()) &lt; 1]">
														<div class="warning"><b>Warning:</b> Element must contain content.</div>
													</xforms:group>
													<!-- address -->
													<xforms:group ref="ead:address">
														<eaditor:address/>
													</xforms:group>
													<!-- date -->
													<xforms:group ref="ead:date">
														<eaditor:date/>
													</xforms:group>
													<!-- num -->
													<xforms:group ref="ead:num">
														<eaditor:num/>
													</xforms:group>
													<!-- paragraph -->
													<xforms:repeat nodeset="ead:p">
														<eaditor:p/>
													</xforms:repeat>
													<!-- publisher -->
													<xforms:group ref="ead:publisher">
														<div>
															<xforms:input ref=".">
																<xforms:label>Publisher</xforms:label>
																<xforms:alert>Required</xforms:alert>
															</xforms:input>
															<xforms:trigger appearance="minimal">
																<xforms:delete ev:event="DOMActivate" nodeset="."/>
																<xforms:label>
																	<span class="glyphicon glyphicon-remove"/>
																</xforms:label>
															</xforms:trigger>
														</div>
													</xforms:group>
												</div>
											</xforms:group>
											<!-- series statement -->
											<xforms:group ref="ead:seriesstmt">
												<div class="subsection">
													<h3>Series Statement</h3>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
													<span class="add">
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>
															</xforms:label>
															<xxforms:show ev:event="DOMActivate" dialog="seriesstmt-objects"/>
														</xforms:trigger>
													</span>
													<xxforms:dialog id="seriesstmt-objects" appearance="full" level="modal" close="true" draggable="true"
														visible="false">
														<xforms:label>Series Statement Elements</xforms:label>
														<xforms:group ref=".[count(ead:num) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Number</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('num-template')"/>
															</xforms:trigger>
														</xforms:group>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Paragraph</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="." nodeset="./child::node()[last()]"
																origin="instance('p-template')"/>
														</xforms:trigger>
														<xforms:group ref=".[count(ead:titleproper) &lt; 1]">
															<xforms:trigger appearance="minimal">
																<xforms:label>
																	<span class="glyphicon glyphicon-plus"/>Title</xforms:label>
																<xforms:insert ev:event="DOMActivate" context="." origin="instance('titleproper-template')"/>
															</xforms:trigger>
														</xforms:group>
													</xxforms:dialog>
													<xforms:group ref=".[count(child::node()) &lt; 1]">
														<div class="warning"><b>Warning:</b> Element must contain content.</div>
													</xforms:group>
													<!-- titleproper -->
													<xforms:group ref="ead:titleproper">
														<eaditor:titleproper/>
													</xforms:group>
													<!-- num -->
													<xforms:group ref="ead:num">
														<eaditor:num/>
													</xforms:group>
													<!-- p -->
													<xforms:repeat nodeset="ead:p">
														<eaditor:p/>
													</xforms:repeat>
												</div>
											</xforms:group>
											<xforms:group ref="ead:notestmt">
												<div class="subsection">
													<h3>Note Statement</h3>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
													<div>
														<xforms:trigger appearance="minimal">
															<xforms:label>
																<span class="glyphicon glyphicon-plus"/>Note</xforms:label>
															<xforms:insert ev:event="DOMActivate" context="." nodeset="child::node()[last()]"
																origin="instance('note-template')"/>
														</xforms:trigger>
													</div>
													<xforms:group ref=".[count(child::ead:note) &lt; 1]">
														<div class="warning"><b>Warning:</b> Note Statement must contain at least one Note.</div>
													</xforms:group>
													<xforms:repeat nodeset="ead:note">
														<eaditor:note/>
													</xforms:repeat>
												</div>
											</xforms:group>
										</xforms:group>
									</div>
									<!-- profile description -->
									<xforms:group ref="ead:profiledesc">
										<div class="section">
											<h2>Profile Description</h2>
											<xforms:trigger appearance="minimal">
												<xforms:delete ev:event="DOMActivate" nodeset="."/>
												<xforms:label>
													<span class="glyphicon glyphicon-remove"/>
												</xforms:label>
											</xforms:trigger>
											<span class="add">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>
													</xforms:label>
													<xxforms:show ev:event="DOMActivate" dialog="profiledesc-objects"/>
												</xforms:trigger>
											</span>
											<xxforms:dialog id="profiledesc-objects" appearance="full" level="modal" close="true" draggable="true"
												visible="false">
												<xforms:label>Profile Description Elements</xforms:label>
												<xforms:group ref=".[count(ead:creation) &lt; 1]">
													<xforms:trigger appearance="minimal">
														<xforms:label>
															<span class="glyphicon glyphicon-plus"/>Creation</xforms:label>
														<xforms:insert ev:event="DOMActivate" context="." at="1" position="before"
															origin="instance('creation-template')"/>
													</xforms:trigger>
												</xforms:group>
												<xforms:group ref=".[count(ead:descrules) &lt; 1]">
													<xforms:trigger appearance="minimal">
														<xforms:label>
															<span class="glyphicon glyphicon-plus"/>Descriptive Rules</xforms:label>
														<xforms:insert ev:event="DOMActivate" context="."
															nodeset="if (ead:creation) then ead:creation else if (ead:langusage) then ./child::node()[position() = 1] else node()"
															origin="instance('descrules-template')"/>
													</xforms:trigger>
												</xforms:group>
												<xforms:group ref=".[count(ead:langusage) &lt; 1]">
													<xforms:trigger appearance="minimal">
														<xforms:label>
															<span class="glyphicon glyphicon-plus"/>Language Usage</xforms:label>
														<xforms:insert ev:event="DOMActivate" context="."
															nodeset="if (ead:descrules) then ead:descrules else if (ead:creation) then ead:creation else if (ead:descrules) then ./child::node()[last()] else node()"
															origin="instance('langusage-template')"/>
													</xforms:trigger>
												</xforms:group>
											</xxforms:dialog>
											<xforms:group ref="ead:creation">
												<eaditor:creation/>
											</xforms:group>
											<xforms:repeat nodeset="ead:descrules">
												<div>
													<xforms:input ref=".">
														<xforms:label>Descriptive Rules</xforms:label>
													</xforms:input>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
												</div>
											</xforms:repeat>
											<xforms:repeat nodeset="ead:langusage">
												<div>
													<xforms:input ref=".">
														<xforms:label>Language Usage</xforms:label>
													</xforms:input>
													<xforms:trigger appearance="minimal">
														<xforms:delete ev:event="DOMActivate" nodeset="."/>
														<xforms:label>
															<span class="glyphicon glyphicon-remove"/>
														</xforms:label>
													</xforms:trigger>
												</div>
											</xforms:repeat>
										</div>
									</xforms:group>
									<xforms:group ref="ead:revisiondesc">
										<div class="section">
											<h2>Revision Description</h2>
											<xforms:trigger appearance="minimal">
												<xforms:delete ev:event="DOMActivate" nodeset="."/>
												<xforms:label>
													<span class="glyphicon glyphicon-remove"/>
												</xforms:label>
											</xforms:trigger>
											<div>
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Change</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="." origin="instance('change-template')"/>
												</xforms:trigger>
											</div>
											<xforms:repeat nodeset="ead:change">
												<div class="pair_div">
													<!-- date -->
													<xforms:group ref="ead:date">
														<eaditor:date/>
													</xforms:group>
													<div>
														<xforms:input ref="ead:item">
															<xforms:label>Item</xforms:label>
														</xforms:input>
													</div>
													<xforms:group ref=".[count(parent::node()/ead:change) &gt; 1]">
														<xforms:trigger appearance="minimal" style="float:right;">
															<xforms:delete ev:event="DOMActivate" nodeset="."/>
															<xforms:label>
																<span class="glyphicon glyphicon-remove"/>
															</xforms:label>
														</xforms:trigger>
													</xforms:group>
												</div>
											</xforms:repeat>
										</div>
									</xforms:group>
								</xforms:group>
							</fr:tab>
							<!--**************************************** END EADHEADER **********************************-->
							<!--**************************************** ARCHDESC **********************************-->
							<fr:tab bind="archdesc-tab">
								<fr:label>Archival Description</fr:label>
								<div class="yui3-g">
									<div class="yui3-u-1">
										<h1>Archival Description</h1>
										<div>
											<xforms:group ref=".[count(ead:dsc) &lt; 1]">
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Description of Subordinate Components</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="." nodeset="./child::node()[last()]"
														origin="instance('dsc-template')"/>
												</xforms:trigger>
											</xforms:group>
										</div>
										<div>
											<xforms:select1 ref="@level">
												<xforms:label>Level</xforms:label>
												<xforms:itemset nodeset="instance('level-template')/level">
													<xforms:label ref="."/>
													<xforms:value ref="@value"/>
												</xforms:itemset>
											</xforms:select1>
										</div>
									</div>
									<div class="yui3-u-1-2">
										<xforms:group ref="ead:did">
											<eaditor:did/>
										</xforms:group>
									</div>
									<div class="yui3-u-1-2">
										<eaditor:component-level/>
									</div>
									<div class="yui3-u-1">
										<xforms:group ref="ead:dsc">
											<h1>Description of Subordinate Components</h1>
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-remove"/>
												</xforms:label>
												<xforms:action ev:event="DOMActivate">
													<xforms:delete nodeset="."/>
												</xforms:action>
											</xforms:trigger>
											<div>
												<xforms:trigger appearance="minimal">
													<xforms:label>
														<span class="glyphicon glyphicon-plus"/>Component</xforms:label>
													<xforms:insert ev:event="DOMActivate" context="." nodeset="./child::node()[last()]"
														origin="instance('c-template')"/>
													<xforms:action ev:event="DOMActivate">
														<xforms:setvalue ref="ead:c[last()]/@id"
															value="concat('c_', string(digest( string( random( true ) ), 'MD5', 'hex' )))"/>
													</xforms:action>
												</xforms:trigger>
											</div>
											<xforms:repeat nodeset="ead:c">
												<eaditor:c/>
											</xforms:repeat>
										</xforms:group>
									</div>
								</div>
							</fr:tab>
							<!--<fr:tab id="preview">
							<fr:label>XML Preview</fr:label>
							<h1>XML Preview</h1>
							<fr:xforms-inspector id="orbeon-xforms-inspector"/>
						</fr:tab>-->
							<!--**************************************** END ARCHDESC **********************************-->
						</fr:tabview>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
